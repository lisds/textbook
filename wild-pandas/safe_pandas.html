
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Handling Pandas safely &#8212; Introduction to Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wild-pandas/safe_pandas';</script>
    <link rel="canonical" href="https://lisds.github.io/textbook/wild-pandas/safe_pandas.html" />
    <link rel="icon" href="../_static/dsfe_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Storing and loading text" href="text_encoding.html" />
    <link rel="prev" title="Merging" href="../useful-pandas/merge.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/dsfe_logo.png" class="logo__image only-light" alt="Introduction to Data Science - Home"/>
    <script>document.write(`<img src="../_static/dsfe_logo.png" class="logo__image only-dark" alt="Introduction to Data Science - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Coding for data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/what-is-data-science.html">What is data science?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/why-data-science.html">Why Data Science?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/tools_techniques.html">Tools and techniques</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/computational-tools.html">Computational Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/statistical-techniques.html">Statistical Techniques</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/text-is-data.html">Text is data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/Plotting_the_Classics.html">Plotting the classics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/Literary_Characters.html">Literary characters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/Another_Kind_Of_Character.html">Another kind of character</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/surviving_computers.html">Surviving the computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/the_software.html">Our tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/using_jupyter.html">Using Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/more_on_jupyter.html">More on the Jupyter notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">On code</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../code-basics/to_code.html">Ode to code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/sampling_problem.html">A sampling problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/three_girls.html">A simpler problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/variables_intro.html">Introduction to variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/variables.html">Variables in code and mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/Names.html">Names and variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/Expressions.html">Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/functions.html">Introduction to functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/Calls.html">Call expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/sub_expressions.html">Expressions, and decoding code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-basics/first_pass_three_girls.html">A first pass at the simple problem</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data types</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data-types/data_types.html">Types of things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/Numbers.html">Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/Strings.html">Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/strings_and_variables.html">Strings, variables and expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/String_Methods.html">String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/Comparison.html">Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/lists.html">Lists</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Arrays</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../arrays/Arrays.html">Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/Ranges.html">Ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/More_on_Arrays.html">More on Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/array_indexing.html">Selecting values from an array</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/filling_arrays.html">Making and filling arrays.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/function_arguments.html">Function arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/rng_choice.html">Random choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/boolean_arrays.html">Boolean arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/leaping_ahead.html">Leaping ahead</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Iteration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../iteration/iteration.html">Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iteration/indentation.html">Indentation, indentation, indentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iteration/reply_supreme.html">Reply to the Supreme Court</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iteration/inference.html">Inference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Population and permutation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../permutation/population_permutation.html">Population and permutation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation/permutation_idea.html">The idea of permutation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation/permutation_and_t_test.html">Permutation and the t-test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation/permutation_pairs.html">Permutations and pairs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data frames</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data-frames/data_frames.html">Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/boolean_indexing.html">Indexing with Boolean arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/data_frame_intro.html">Introduction to data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/df_index.html">The DataFrame and the index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/df_basic_col_indexing.html">Selecting columns from DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/df_sort_head_tail.html">Sorting, heads and tails</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/series_like_arrays.html">Series are like arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/df_basic_row_indexing.html">Selecting rows from DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/value_counts.html">Value counts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced indexing in Pandas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pandas_indexing.html">Indexing in Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing_catechism.html">The doctrine of Pandas indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing_assignment.html">Assignment with indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing_expressions.html">Pandas and indexing expressions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Crosstabulation and inference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../useful-pandas/crosstab.html">Cross-tabulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="np_repeat.html">Numpy repeat</a></li>
<li class="toctree-l1"><a class="reference internal" href="fishers_tea.html">Lady tasting tea</a></li>
<li class="toctree-l1"><a class="reference internal" href="counts_to_observations.html">Counts to observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="tea_with_chi.html">Chi-squared and the lady tasting tea</a></li>
<li class="toctree-l1"><a class="reference internal" href="noble_politics.html">Noble politics and comparing counts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful Pandas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data-frames/missing_values.html">Missing values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-frames/df_plotting.html">Pandas plotting methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful-pandas/groupby.html">The power of groupby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful-pandas/merge.html">Merging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pandas pitfalls</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Handling Pandas safely</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_encoding.html">Storing and loading text</a></li>
<li class="toctree-l1"><a class="reference internal" href="numbers_and_strings.html">Numbers and strings</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">More building blocks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/more_building_blocks.html">More building blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/introducing_functions.html">Introducing Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/none.html">On None</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/conditional_statements.html">Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/functions_as_values.html">Functions as values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions-conditionals/apply_functions.html">Apply functions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The mean and straight lines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/mean.html">The mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/mean_meaning.html">The meaning of the mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/np_argmin.html">Argmin (and argmax)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/mean_and_slopes.html">The mean and slopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/sse_rmse.html">Sum of squares, root mean square</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/finding_lines.html">Finding lines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/using_minimize.html">Using minimize</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/inference_on_slopes.html">Inference on slopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/combining_boolean_arrays.html">Combining boolean arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/standard_scores.html">Standard scores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mean-slopes/Correlation.html">Correlation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Classification</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../classification/classification.html">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Nearest_Neighbors.html">Nearest neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Training_and_Testing.html">Training and testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Rows_of_Tables.html">Rows of tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Implementing_the_Classifier.html">Implementing the classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Accuracy_of_the_Classifier.html">Accuracy of the classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/Multiple_Regression.html">Multiple regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/single_multiple.html">Simple and multiple regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">More on regression</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../more-regression/logistic_regression.html">Logistic regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Confidence</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../confidence/confidence.html">On confidence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/bootstrap.html">The Bootstrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/havana_math.html">A problem for the education minister</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/Central_Limit_Theorem.html">The Central Limit Theorem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/large_numbers.html">The law of large numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/laws_of_probability.html">Laws of probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/first_bayes.html">First Bayes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/bayes_theorem.html">Bayes theorem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/bayes_bars.html">Bayes and bars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/confident_treatment.html">Confident treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../confidence/bayes_confidence.html">Bayes, confidence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The end of the beginning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../end/end_of_beginning.html">The end of the beginning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra pages</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../extra/extra.html">Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/more_on_lists.html">More on lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/introducing_python.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/brisk_python.html">Brisk introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/pathlib.html">Using the <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/monty_hall_lists.html">The Monty Hall problem, with lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/data8_functions.html">Data 8 explanation of functions</a></li>

<li class="toctree-l1"><a class="reference internal" href="../extra/mean_deviations.html">Why the differences from the mean must add to zero.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/mean_sq_deviations.html">The mean and squared differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/slope_deviations.html">Mathematics for the least-squares slope</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/lisds/textbook/main?urlpath=lab/tree/wild-pandas/safe_pandas.Rmd" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://ds.lis.2i2c.cloud/hub/user-redirect/git-pull?repo=https%3A//github.com/lisds/textbook&urlpath=lab/tree/textbook/wild-pandas/safe_pandas.Rmd&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/lisds/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/lisds/textbook/edit/main/wild-pandas/safe_pandas.Rmd" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/lisds/textbook/issues/new?title=Issue%20on%20page%20%2Fwild-pandas/safe_pandas.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/wild-pandas/safe_pandas.Rmd" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.Rmd</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Handling Pandas safely</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-have-pandas-version-1-5-or-later-you-can-skip-this-page">If you have Pandas version 1.5 or later, you can skip this page</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avoiding-trouble">Avoiding trouble</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-copies-and-views">Background: copies and views</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-strategy-pandas-1-5-automatic-copies-when-needed">New Strategy (Pandas &gt;= 1.5): automatic copies when needed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chained-assignment-and-copy-on-write">“Chained assignment” and copy-on-write</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-for-pandas-1-5-three-simple-rules">Old Strategy (for Pandas &lt; 1.5): three simple rules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-1-copy-right">Old strategy rule 1: copy right.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-digression-copies-views-confusing-warnings">A digression: copies, views, confusing, warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-2-make-errors-for-copy-view-warnings">Old strategy rule 2: make errors for copy/view warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-digression-copy-views-on-the-left">Another digression: copy, views, on the left</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-3-loc-left">Old strategy rule 3: loc left</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-summary-keep-calm-follow-the-three-rules">Old strategy summary: keep calm, follow the three rules</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="handling-pandas-safely">
<h1>Handling Pandas safely<a class="headerlink" href="#handling-pandas-safely" title="Link to this heading">#</a></h1>
<p>A lot of Pandas’ design is for speed and efficiency.</p>
<p>Unfortunately, this sometimes means that is it easy to use Pandas incorrectly,
and so get results that you do not expect.</p>
<section id="if-you-have-pandas-version-1-5-or-later-you-can-skip-this-page">
<h2>If you have Pandas version 1.5 or later, you can skip this page<a class="headerlink" href="#if-you-have-pandas-version-1-5-or-later-you-can-skip-this-page" title="Link to this heading">#</a></h2>
<p>This page discusses the problems that can come up when Pandas keeps links
between different DataFrames and Series.  As you will see below, this is the
issue of Pandas <em>copies</em> and <em>views</em>.</p>
<p>Luckily, as of Pandas version 1.5, there is an option you can enable that will
allow you to avoid this rather complicated distinction, and, if you have a Pandas
version of 1.5 or greater, we strongly suggest you enable that option, like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.copy_on_write&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You will see that option in all the notebooks from this course, and, if you
can, we suggest you set that option whenever you import and use Pandas.</p>
<p>You will see more details about what the option means further down this page,
so read on if you are interested.</p>
</section>
<section id="avoiding-trouble">
<h2>Avoiding trouble<a class="headerlink" href="#avoiding-trouble" title="Link to this heading">#</a></h2>
<p>The rest of this page has some background on the issue of Pandas copies and
views, and an explanation of the problems that can come up for older Pandas, or
when you do not enable the <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> option.  We explain the
<code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> option, and give some rules to help you stay out of
trouble, if you cannot use <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code>.</p>
</section>
<section id="background-copies-and-views">
<h2>Background: copies and views<a class="headerlink" href="#background-copies-and-views" title="Link to this heading">#</a></h2>
<p>Consider this DataFrame, which should be familiar. It is a table where the
rows are course subjects and the columns include average ratings for all
University professors / lecturers teaching that subject. See <a class="reference internal" href="../data/rate_my_professors.html"><span class="doc std std-doc">the dataset
page</span></a> for more detail.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that we have not yet enabled the <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> option.</p>
<p>We get the ratings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;rate_my_course.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To ease some later exposition, we select the first 10 rows, and set the row
labels (index) to be letters rather than numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">all_ratings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCDEFGHIJ&#39;</span><span class="p">)</span>
<span class="n">ratings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>3.756147</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
    <tr>
      <th>F</th>
      <td>Chemistry</td>
      <td>7346</td>
      <td>3.387174</td>
      <td>3.538980</td>
      <td>3.465485</td>
      <td>2.652054</td>
    </tr>
    <tr>
      <th>G</th>
      <td>Communications</td>
      <td>6940</td>
      <td>3.867349</td>
      <td>3.878602</td>
      <td>3.875019</td>
      <td>3.379829</td>
    </tr>
    <tr>
      <th>H</th>
      <td>Business</td>
      <td>6120</td>
      <td>3.640327</td>
      <td>3.680503</td>
      <td>3.663332</td>
      <td>3.172033</td>
    </tr>
    <tr>
      <th>I</th>
      <td>Political Science</td>
      <td>5824</td>
      <td>3.759018</td>
      <td>3.748676</td>
      <td>3.756197</td>
      <td>3.057758</td>
    </tr>
    <tr>
      <th>J</th>
      <td>Economics</td>
      <td>5540</td>
      <td>3.382735</td>
      <td>3.483617</td>
      <td>3.435038</td>
      <td>2.910078</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now imagine that we have discovered that the rating for ‘Clarity’ in the first
row is incorrect; it should be 4.0.</p>
<p>We get ready to make a new, fixed copy of the DataFrame, to store the modified
values.  We put the ‘Disciplines’ column into the DataFrame to start with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fixed_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">fixed_ratings</span><span class="p">[</span><span class="s1">&#39;Discipline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Discipline&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Our next obvious step is to get the ‘Clarity’ column as a Pandas Series, for us
to work on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clarity</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span>
<span class="n">clarity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    3.756147
B    3.487379
C    3.608331
D    3.909520
E    3.788818
Name: Clarity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We set the corrected first value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clarity</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">clarity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6234/111022653.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  clarity.loc[&#39;A&#39;] = 4
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    4.000000
B    3.487379
C    3.608331
D    3.909520
E    3.788818
Name: Clarity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Notice the warning.  We will come back to that soon.</p>
<p>Notice too that we have changed the value in the <code class="docutils literal notranslate"><span class="pre">clarity</span></code> Series.</p>
<p>Consider — <strong>what happens to the matching value in the original DataFrame</strong>?</p>
<p>To answer that question, we need to know what kind of thing our <code class="docutils literal notranslate"><span class="pre">clarity</span></code>
Series was.  <em>If you have not enabled <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code></em>, the <code class="docutils literal notranslate"><span class="pre">clarity</span></code>
could be a <em>copy</em> or a <em>view</em>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">clarity</span></code> Series is a <em>view</em>, then it still refers directly to the
‘Clarity’ column in the original data frame <code class="docutils literal notranslate"><span class="pre">ratings</span></code>.  A view is something
that points to the <em>same memory</em>.  When we have a view, the view is another way
of looking at the <em>same data</em>.  If we modify the data in the <em>view</em>, that means
we also modify the <em>original</em> DataFrame, because the <em>data is the same</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">clarity</span></code> could also be <em>copy</em> of the ‘Clarity’ column. A copy duplicates the
values from the original data.  Therefore a copy has its own values, and its
own memory.  Changing the data in the copy will have no effect on the original
DataFrame, because the <em>data is different</em>.</p>
<p><strong>Note</strong>: if you have enabled <code class="docutils literal notranslate"><span class="pre">mode.copy_on_view</span></code>, <code class="docutils literal notranslate"><span class="pre">clarity</span></code> will always
(effectively) be a copy, and you will not see the behavior below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>4.000000</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We have found that the <code class="docutils literal notranslate"><span class="pre">clarity</span></code> Series was a <em>view</em>, because the change we
made to <code class="docutils literal notranslate"><span class="pre">clarity</span></code> also changed the value in the original DataFrame.</p>
<p>This may not be what you expected, so you probably did not mean to change the
original data.</p>
<p>There are two basic strategies for dealing with this problem.</p>
</section>
<section id="new-strategy-pandas-1-5-automatic-copies-when-needed">
<h2>New Strategy (Pandas &gt;= 1.5): automatic copies when needed<a class="headerlink" href="#new-strategy-pandas-1-5-automatic-copies-when-needed" title="Link to this heading">#</a></h2>
<p>This strategy uses a feature that is new in Pandas version 1.5.</p>
<p>The summary is — always put the following line after you import Pandas, and
before you execute any code using Pandas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ask Pandas to make a copy under the hood, when needed.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.copy_on_write&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After you apply this option, Pandas uses an algorithm to work out when to make
a copy.  You can think if the option as being equivalent to making everything a
copy.   For example, consider the problem we had above.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The current values of the `ratings` DataFrame.</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>4.000000</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A column from the DataFrame.</span>
<span class="n">clarity</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span>
<span class="n">clarity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    4.000000
B    3.487379
C    3.608331
D    3.909520
E    3.788818
Name: Clarity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>As before, we set another corrected first value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clarity</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="n">clarity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    99.000000
B     3.487379
C     3.608331
D     3.909520
E     3.788818
Name: Clarity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We set <code class="docutils literal notranslate"><span class="pre">clarity</span></code> as we expected.  But this time, with the <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code>
option, we did not change the <code class="docutils literal notranslate"><span class="pre">ratings</span></code> DataFrame from which we selected the
<code class="docutils literal notranslate"><span class="pre">clarity</span></code> values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>4.000000</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice that the first <code class="docutils literal notranslate"><span class="pre">Clarity</span></code> value in <code class="docutils literal notranslate"><span class="pre">ratings</span></code> did not change — it is still
4 and not 99.</p>
<p>The value in <code class="docutils literal notranslate"><span class="pre">ratings</span></code> did not change because you can think of the
<code class="docutils literal notranslate"><span class="pre">ratings['Clarity']</span></code> expression as <em>always taking a copy not a view</em>
<a class="footnote-reference brackets" href="#copy-write" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<p>If you have Pandas &gt;= 1.5, we strongly suggest you apply this strategy.  And in
fact, you will see that all the notebooks in this course that <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pandas</span></code>
also have the magic line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.copy_on_write&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="chained-assignment-and-copy-on-write">
<h3>“Chained assignment” and copy-on-write<a class="headerlink" href="#chained-assignment-and-copy-on-write" title="Link to this heading">#</a></h3>
<p>Remember, we have <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> enabled here.</p>
<p>Consider the following code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_A</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>  <span class="c1"># Effectively, a *copy* of row labeled A.</span>
<span class="n">row_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">199</span>
</pre></div>
</div>
</div>
</div>
<p>Sure enough, you have set the <code class="docutils literal notranslate"><span class="pre">row_A</span></code> <code class="docutils literal notranslate"><span class="pre">Clarity</span></code> value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                      199
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>At this stage, with <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> enabled, you would expect the first
row of <code class="docutils literal notranslate"><span class="pre">ratings</span></code> to stay the same, because Pandas effectively copies the first
row, before doing the assignment into the copy.  And you’d be right to expect
that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                      4.0
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>But — you may sometimes fail to think of this copy, and be surprised at the
result.  For example, consider the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Chained assignment&quot;.</span>
<span class="c1"># Assigning a value to a chain of fetched values.</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">199</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6234/4222313501.py:3: ChainedAssignmentError: A value is trying to be set on a copy of a DataFrame or Series through chained assignment.
When using the Copy-on-Write mode, such chained assignment never works to update the original DataFrame or Series, because the intermediate object on which we are setting values always behaves as a copy.

Try using &#39;.loc[row_indexer, col_indexer] = value&#39; instead, to perform the assignment in a single step.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratings.loc[&#39;A&#39;].loc[&#39;Clarity&#39;] = 199
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                      4.0
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Notice that here, <code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code> does not change.</p>
<p>This kind of code is sometimes called <em>chained assignment</em> because you are
<em>chaining</em> the fetch of the values on the left hand side.  First you are
fetching <code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code> and then, from the result, you fetching the <code class="docutils literal notranslate"><span class="pre">Clarity</span></code>
value.  Then you are <em>assigning</em> to this <em>chain</em> of fetched values.</p>
<p>Chained assignment can be confusing, because the first line in the cell above
<em>looks as if</em> it is setting the <code class="docutils literal notranslate"><span class="pre">Clarity</span></code> value for the row labeled ‘A’.  But
in fact, the code is exactly equivalent to the code cells just above that, and
has the same effect. That is <code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code> effectively results in a copy,
so <code class="docutils literal notranslate"><span class="pre">ratings.loc['A'].loc['Clarity']</span> <span class="pre">=</span> <span class="pre">99</span></code> is setting the <code class="docutils literal notranslate"><span class="pre">Clarity</span></code> value to 99
<em>in the copy</em>, which Python will then immediately discard, because you are not
storing the copy anywhere.  So, if you are not careful, you may <em>think</em> you are
modifying the underlying <code class="docutils literal notranslate"><span class="pre">ratings</span></code> DataFrame, but you are not, because of the
internal copying implied by <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code>.</p>
<p>If you do want to set the <code class="docutils literal notranslate"><span class="pre">Clarity</span></code> value of the row labeled ‘A’, you need to
have a left hand side that does not use the chaining that you see above.  To do
this, specify the row and column in a single left-hand-side expression, like
this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Unchained assignment&quot;.</span>
<span class="c1"># Assigning a value directly to a fetched value, no chain.</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">199</span>  <span class="c1"># No chain on the left-hand side.</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                    199.0
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="old-strategy-for-pandas-1-5-three-simple-rules">
<h2>Old Strategy (for Pandas &lt; 1.5): three simple rules<a class="headerlink" href="#old-strategy-for-pandas-1-5-three-simple-rules" title="Link to this heading">#</a></h2>
<p>But now we return to the older, darker world of Pandas &lt; 1.5, where you cannot
enable <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code>.   What should you do then?   In the rest of the
page, we suggest and explain three simple rules to stay out of trouble.</p>
<p>As your understanding increases, you may find that you can relax some of these
rules, but the problems in this page can trip up experts, so please, be very
careful, and only relax these rules when you are very confident you understand
the underlying problems.  See <a class="reference internal" href="gory_pandas.html"><span class="doc std std-doc">Gory Pandas</span></a> for a short walk
through some of the complexities.</p>
<p>To make the rest of the notebook be more like older Pandas, we turn off the
<code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> feature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To make Pandas in the rest of this notebook look more like Pandas &lt; 1.5.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.copy_on_write&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="old-strategy-rule-1-copy-right">
<h3>Old strategy rule 1: copy right.<a class="headerlink" href="#old-strategy-rule-1-copy-right" title="Link to this heading">#</a></h3>
<p>We strongly suggest that when you get stuff out of a Pandas DataFrame or Series
by indexing, to use as a right-hand-side value, you always force Pandas to take
a copy.</p>
<p>We call this rule <em>copy right</em>.</p>
<p>As a reminder <em>indexing</em> is where we fetch data from something using square
brackets.  Indexing can be: <em>direct</em>, with the square brackets directly
following the DataFrame or Series; or <em>indirect</em>, where the square brackets
follow the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> or <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> attributes of the DataFrame or Series.</p>
<p>For example, we have just used direct indexing (square brackets) to fetch the
‘Clarity’ data out of the <code class="docutils literal notranslate"><span class="pre">ratings</span></code> DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Indexing to fetch a Series from a DataFrame.</span>
<span class="n">clarity</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We earlier found that, without <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code>,  <code class="docutils literal notranslate"><span class="pre">clarity</span></code> is a <em>view</em>
onto the ‘Clarity’ data in <code class="docutils literal notranslate"><span class="pre">ratings</span></code>. This is rarely what we want.</p>
<p>Here we apply the <em>copy right</em> rule:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Applying the &quot;copy right&quot; rule.</span>
<span class="n">clearer_clarity</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Notice we apply the <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> method to the ‘Clarity’ Series, so forcing Pandas
to make and return a copy of the data.</p>
<p>Now we have done that, we can modify the result without affecting the original
DataFrame, because we are changing the copy, not the original.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modify the copy with some crazy value.</span>
<span class="n">clearer_clarity</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="n">clearer_clarity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    99.000000
B     3.487379
C     3.608331
D     3.909520
E     3.788818
Name: Clarity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This does not affect the original DataFrame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>199.000000</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="a-digression-copies-views-confusing-warnings">
<h3>A digression: copies, views, confusing, warnings<a class="headerlink" href="#a-digression-copies-views-confusing-warnings" title="Link to this heading">#</a></h3>
<p>It can be very difficult to predict when Pandas indexing will give a copy or a
view.</p>
<p>For example, here we use indirect indexing (square brackets following <code class="docutils literal notranslate"><span class="pre">.loc</span></code>)
to select the row of <code class="docutils literal notranslate"><span class="pre">ratings</span></code> with index label ‘A’.  Remember <code class="docutils literal notranslate"><span class="pre">.loc</span></code> indexing
uses the <em>index labels</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_A</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">row_A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                    199.0
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>We saw earlier that direct indexing to select a column ‘Clarity’ gave us a
view, meaning that we could change the values in the DataFrame by changing the
Series <code class="docutils literal notranslate"><span class="pre">clarity</span></code> we got from indexing.  In fact this is also true if we use
indirect indexing with <code class="docutils literal notranslate"><span class="pre">.loc</span></code> or <code class="docutils literal notranslate"><span class="pre">.iloc</span></code>.  Check this by trying <code class="docutils literal notranslate"><span class="pre">clarity</span> <span class="pre">=</span> <span class="pre">ratings.loc[:,</span> <span class="pre">'Clarity']</span></code> in the code above.</p>
<p>We have just fetched the row labeled ‘A’ using <code class="docutils literal notranslate"><span class="pre">.loc</span></code>.  Given what we know
about fetching a column, it would be reasonable to predict this would give us a
view.</p>
<p>Does it give a view?  Or a copy?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Changing the &#39;Clarity&#39; value of the first row.</span>
<span class="n">row_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">row_A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6234/3087147381.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  row_A.loc[&#39;Clarity&#39;] = 5
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                        5
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Notice the warning, again.</p>
<p>But - this time - did we change the original DataFrame?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Discipline</th>
      <th>Number of Professors</th>
      <th>Clarity</th>
      <th>Helpfulness</th>
      <th>Overall Quality</th>
      <th>Easiness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>English</td>
      <td>23343</td>
      <td>199.000000</td>
      <td>3.821866</td>
      <td>3.791364</td>
      <td>3.162754</td>
    </tr>
    <tr>
      <th>B</th>
      <td>Mathematics</td>
      <td>22394</td>
      <td>3.487379</td>
      <td>3.641526</td>
      <td>3.566867</td>
      <td>3.063322</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Biology</td>
      <td>11774</td>
      <td>3.608331</td>
      <td>3.701530</td>
      <td>3.657641</td>
      <td>2.710459</td>
    </tr>
    <tr>
      <th>D</th>
      <td>Psychology</td>
      <td>11179</td>
      <td>3.909520</td>
      <td>3.887536</td>
      <td>3.900949</td>
      <td>3.316210</td>
    </tr>
    <tr>
      <th>E</th>
      <td>History</td>
      <td>11145</td>
      <td>3.788818</td>
      <td>3.753642</td>
      <td>3.773746</td>
      <td>3.053803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>No, we didn’t change the original DataFrame — and we conclude that <code class="docutils literal notranslate"><span class="pre">row_A</span></code> is a
<em>copy</em>.</p>
<p>Our first, correct, response is to follow the <em>copy right</em> rule, and make this
copy explicit, so we know exactly what we have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The &quot;copy right&quot; rule again.</span>
<span class="n">copied_row_A</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We no longer have a nasty warning when we modify <code class="docutils literal notranslate"><span class="pre">copied_row_A</span></code>, because Pandas
knows we made a copy, so it does not need to warn us that we may be making a
mistake:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We don&#39;t get a warning when we change the copied result.</span>
<span class="n">copied_row_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">copied_row_A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                        5
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>Please <em>do</em> worry about these warnings</strong>.  In fact, in the interests of
safety, we come to old strategy rule 2.</p>
</section>
<section id="old-strategy-rule-2-make-errors-for-copy-view-warnings">
<h3>Old strategy rule 2: make errors for copy/view warnings<a class="headerlink" href="#old-strategy-rule-2-make-errors-for-copy-view-warnings" title="Link to this heading">#</a></h3>
<p>Pandas has a setting that allows you to change the nasty warning about setting
with copies into an error.</p>
<p>If you can’t enable <code class="docutils literal notranslate"><span class="pre">mode.copy_on_write</span></code> as above, we strongly suggest that you
do enable these errors, for all your notebooks, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;mode.chained_assignment&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After you have set this option, Pandas will stop if you try to do something like the following:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_A</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>   <span class="c1"># Copy?  Or view?  Difficult to guess.</span>
<span class="c1"># Now this generates an error.</span>
<span class="n">row_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">SettingWithCopyError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">/tmp/ipykernel_6234/1769055592.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">row_A</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>   <span class="c1"># Copy?  Or view?  Difficult to guess.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># Now this generates an error.</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">row_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_has_valid_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> 
<span class="g g-Whitespace">    </span><span class="mi">910</span>         <span class="n">iloc</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;iloc&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">iloc</span>
<span class="ne">--&gt; </span><span class="mi">911</span>         <span class="n">iloc</span><span class="o">.</span><span class="n">_setitem_with_indexer</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1940</span>         <span class="k">if</span> <span class="n">take_split_path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1941</span>             <span class="c1"># We have to operate column-wise</span>
<span class="g g-Whitespace">   </span><span class="mi">1942</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_with_indexer_split_path</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1943</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1944</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_single_block</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">2211</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ABCDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;iloc&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2212</span>             <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_align_frame</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span> 
<span class="g g-Whitespace">   </span><span class="mi">2214</span>         <span class="c1"># check for chained assignment</span>
<span class="ne">-&gt; </span><span class="mi">2215</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2216</span> 
<span class="g g-Whitespace">   </span><span class="mi">2217</span>         <span class="c1"># actually do the set</span>
<span class="g g-Whitespace">   </span><span class="mi">2218</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span><span class="o">.</span><span class="n">setitem</span><span class="p">(</span><span class="n">indexer</span><span class="o">=</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/series.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1489</span>             <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cacher</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1490</span>             <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ref</span><span class="o">.</span><span class="n">_is_mixed_type</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1491</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_check_setitem_copy</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s2">&quot;referent&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1492</span>             <span class="k">return</span> <span class="kc">True</span>
<span class="ne">-&gt; </span><span class="mi">1493</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">4395</span>         <span class="n">single</span><span class="o">-</span><span class="n">dtype</span> <span class="n">meaning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">cacher</span> <span class="n">should</span> <span class="n">be</span> <span class="n">updated</span> <span class="n">following</span>
<span class="g g-Whitespace">   </span><span class="mi">4396</span>         <span class="n">setting</span><span class="o">.</span>
<span class="g g-Whitespace">   </span><span class="mi">4397</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4398</span><span class="s2">         if self._is_copy:</span>
<span class="ne">-&gt; </span><span class="mi">4399</span><span class="s2">             self._check_setitem_copy(t=&quot;referent&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">4400</span><span class="s2">         return False</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self, t, force)</span>
<span class="g g-Whitespace">   </span><span class="mi">4469</span><span class="s2">                 &quot;indexing.html#returning-a-view-versus-a-copy&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4470</span><span class="s2">             )</span>
<span class="g g-Whitespace">   </span><span class="mi">4471</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4472</span><span class="s2">         if value == &quot;raise&quot;:</span>
<span class="ne">-&gt; </span><span class="mi">4473</span><span class="s2">             raise SettingWithCopyError(t)</span>
<span class="g g-Whitespace">   </span><span class="mi">4474</span><span class="s2">         if value == &quot;warn&quot;:</span>
<span class="g g-Whitespace">   </span><span class="mi">4475</span><span class="s2">             warnings.warn(t, SettingWithCopyWarning, stacklevel=find_stack_level())</span>

<span class="ne">SettingWithCopyError</span>: 
<span class="s2">A value is trying to be set on a copy of a slice from a DataFrame</span>

<span class="s2">See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</span>
</pre></div>
</div>
</div>
</div>
<p>At first you will find this advice annoying.  Your code will generate confusing
errors, and you will be tempted to remove this error option to make the errors
go away.  Please be patient.  You will find that, if you follow the <em>copy
right</em> rule carefully, most of these errors go away.</p>
</section>
<section id="another-digression-copy-views-on-the-left">
<h3>Another digression: copy, views, on the left<a class="headerlink" href="#another-digression-copy-views-on-the-left" title="Link to this heading">#</a></h3>
<p>There is more discussion of this subject in the <a class="reference internal" href="gory_pandas.html"><span class="std std-doc">Gory Pandas
page</span></a>.</p>
<p>If you are reading this page from start to finish, you will have already seen
our discussion of chained assignment above.  Here we repeat ourselves a little
for the sake our our less linear readers. Consider this code:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6234/1657792584.py:1: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df[&quot;col&quot;][row_indexer] = value

Use `df.loc[row_indexer, &quot;col&quot;] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  ratings.loc[&#39;A&#39;].loc[&#39;Clarity&#39;] = 299
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">SettingWithCopyError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">/tmp/ipykernel_6234/1657792584.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_has_valid_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> 
<span class="g g-Whitespace">    </span><span class="mi">910</span>         <span class="n">iloc</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;iloc&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">iloc</span>
<span class="ne">--&gt; </span><span class="mi">911</span>         <span class="n">iloc</span><span class="o">.</span><span class="n">_setitem_with_indexer</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1940</span>         <span class="k">if</span> <span class="n">take_split_path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1941</span>             <span class="c1"># We have to operate column-wise</span>
<span class="g g-Whitespace">   </span><span class="mi">1942</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_with_indexer_split_path</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1943</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1944</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_single_block</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">2211</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ABCDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;iloc&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2212</span>             <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_align_frame</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span> 
<span class="g g-Whitespace">   </span><span class="mi">2214</span>         <span class="c1"># check for chained assignment</span>
<span class="ne">-&gt; </span><span class="mi">2215</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2216</span> 
<span class="g g-Whitespace">   </span><span class="mi">2217</span>         <span class="c1"># actually do the set</span>
<span class="g g-Whitespace">   </span><span class="mi">2218</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span><span class="o">.</span><span class="n">setitem</span><span class="p">(</span><span class="n">indexer</span><span class="o">=</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/series.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1489</span>             <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cacher</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1490</span>             <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ref</span><span class="o">.</span><span class="n">_is_mixed_type</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1491</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_check_setitem_copy</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s2">&quot;referent&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1492</span>             <span class="k">return</span> <span class="kc">True</span>
<span class="ne">-&gt; </span><span class="mi">1493</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">4395</span>         <span class="n">single</span><span class="o">-</span><span class="n">dtype</span> <span class="n">meaning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">cacher</span> <span class="n">should</span> <span class="n">be</span> <span class="n">updated</span> <span class="n">following</span>
<span class="g g-Whitespace">   </span><span class="mi">4396</span>         <span class="n">setting</span><span class="o">.</span>
<span class="g g-Whitespace">   </span><span class="mi">4397</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4398</span><span class="s2">         if self._is_copy:</span>
<span class="ne">-&gt; </span><span class="mi">4399</span><span class="s2">             self._check_setitem_copy(t=&quot;referent&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">4400</span><span class="s2">         return False</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self, t, force)</span>
<span class="g g-Whitespace">   </span><span class="mi">4469</span><span class="s2">                 &quot;indexing.html#returning-a-view-versus-a-copy&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4470</span><span class="s2">             )</span>
<span class="g g-Whitespace">   </span><span class="mi">4471</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4472</span><span class="s2">         if value == &quot;raise&quot;:</span>
<span class="ne">-&gt; </span><span class="mi">4473</span><span class="s2">             raise SettingWithCopyError(t)</span>
<span class="g g-Whitespace">   </span><span class="mi">4474</span><span class="s2">         if value == &quot;warn&quot;:</span>
<span class="g g-Whitespace">   </span><span class="mi">4475</span><span class="s2">             warnings.warn(t, SettingWithCopyWarning, stacklevel=find_stack_level())</span>

<span class="ne">SettingWithCopyError</span>: 
<span class="s2">A value is trying to be set on a copy of a slice from a DataFrame</span>

<span class="s2">See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</span>
</pre></div>
</div>
</div>
</div>
<p>Because we have set the <code class="docutils literal notranslate"><span class="pre">mode.chained_assignment</span></code> option to <code class="docutils literal notranslate"><span class="pre">error</span></code> above, this
generates an error — but why?</p>
<p>The reason is the same as the reason for the previous error.  The code in the
cell directly above is just a short-cut for this exact equivalent.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">SettingWithCopyError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">/tmp/ipykernel_6234/2016657039.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_has_valid_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> 
<span class="g g-Whitespace">    </span><span class="mi">910</span>         <span class="n">iloc</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;iloc&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">iloc</span>
<span class="ne">--&gt; </span><span class="mi">911</span>         <span class="n">iloc</span><span class="o">.</span><span class="n">_setitem_with_indexer</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1940</span>         <span class="k">if</span> <span class="n">take_split_path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1941</span>             <span class="c1"># We have to operate column-wise</span>
<span class="g g-Whitespace">   </span><span class="mi">1942</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_with_indexer_split_path</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1943</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1944</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_single_block</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">2211</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ABCDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;iloc&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2212</span>             <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_align_frame</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span> 
<span class="g g-Whitespace">   </span><span class="mi">2214</span>         <span class="c1"># check for chained assignment</span>
<span class="ne">-&gt; </span><span class="mi">2215</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2216</span> 
<span class="g g-Whitespace">   </span><span class="mi">2217</span>         <span class="c1"># actually do the set</span>
<span class="g g-Whitespace">   </span><span class="mi">2218</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span><span class="o">.</span><span class="n">setitem</span><span class="p">(</span><span class="n">indexer</span><span class="o">=</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/series.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1489</span>             <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cacher</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1490</span>             <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ref</span><span class="o">.</span><span class="n">_is_mixed_type</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1491</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_check_setitem_copy</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s2">&quot;referent&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1492</span>             <span class="k">return</span> <span class="kc">True</span>
<span class="ne">-&gt; </span><span class="mi">1493</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">4395</span>         <span class="n">single</span><span class="o">-</span><span class="n">dtype</span> <span class="n">meaning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">cacher</span> <span class="n">should</span> <span class="n">be</span> <span class="n">updated</span> <span class="n">following</span>
<span class="g g-Whitespace">   </span><span class="mi">4396</span>         <span class="n">setting</span><span class="o">.</span>
<span class="g g-Whitespace">   </span><span class="mi">4397</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4398</span><span class="s2">         if self._is_copy:</span>
<span class="ne">-&gt; </span><span class="mi">4399</span><span class="s2">             self._check_setitem_copy(t=&quot;referent&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">4400</span><span class="s2">         return False</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self, t, force)</span>
<span class="g g-Whitespace">   </span><span class="mi">4469</span><span class="s2">                 &quot;indexing.html#returning-a-view-versus-a-copy&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4470</span><span class="s2">             )</span>
<span class="g g-Whitespace">   </span><span class="mi">4471</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4472</span><span class="s2">         if value == &quot;raise&quot;:</span>
<span class="ne">-&gt; </span><span class="mi">4473</span><span class="s2">             raise SettingWithCopyError(t)</span>
<span class="g g-Whitespace">   </span><span class="mi">4474</span><span class="s2">         if value == &quot;warn&quot;:</span>
<span class="g g-Whitespace">   </span><span class="mi">4475</span><span class="s2">             warnings.warn(t, SettingWithCopyWarning, stacklevel=find_stack_level())</span>

<span class="ne">SettingWithCopyError</span>: 
<span class="s2">A value is trying to be set on a copy of a slice from a DataFrame</span>

<span class="s2">See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</span>
</pre></div>
</div>
</div>
</div>
<p>Specifically, when Python sees <code class="docutils literal notranslate"><span class="pre">ratings.loc['A'].loc['Clarity']</span> <span class="pre">=</span> <span class="pre">299</span></code>, it first
evaluates <code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code> to generate a temporary copy.  In the code above, we
called this temporary copy <code class="docutils literal notranslate"><span class="pre">tmp</span></code>. It then tries to set the value into the copy
with <code class="docutils literal notranslate"><span class="pre">tmp.loc['Clarity']</span> <span class="pre">=</span> <span class="pre">299</span></code>.  This generates the same error as you saw
before.</p>
<p>As you have probably guessed from the option name above, Pandas calls this
<em>chained assignment</em>, because you are: first, fetching the stuff you want do
the assignment on (<code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code>) and then doing the assignment
<code class="docutils literal notranslate"><span class="pre">.loc['Clarity']</span> <span class="pre">=</span> <span class="pre">299</span></code>. There are two steps on the left hand side, in a chain,
first fetching the data, then assigning.</p>
<p>The problem that Pandas has is that it cannot tell that this chained assignment
has happened, so it can’t tell what you mean.  Python will ask Pandas to
generate <code class="docutils literal notranslate"><span class="pre">ratings.loc['A']</span></code> first, which it does, to generate the temporary copy
that we can call <code class="docutils literal notranslate"><span class="pre">tmp</span></code>. Python then asks Pandas to set the value with
<code class="docutils literal notranslate"><span class="pre">tmp.loc['Clarity']</span> <span class="pre">=</span> <span class="pre">299</span></code>.  When Pandas gets this second instruction, it has no
way of knowing that <code class="docutils literal notranslate"><span class="pre">tmp</span></code> came from the combined instruction
<code class="docutils literal notranslate"><span class="pre">ratings.loc['A'].loc['Clarity']</span> <span class="pre">=</span> <span class="pre">299</span></code>, and so all it can do is set the value
into the copy, as instructed.</p>
<p>This leads us to the last rule.</p>
</section>
<section id="old-strategy-rule-3-loc-left">
<h3>Old strategy rule 3: loc left<a class="headerlink" href="#old-strategy-rule-3-loc-left" title="Link to this heading">#</a></h3>
<p>When you do want to use indexing on the left hand side, to set some values into
a DataFrame or Series, try do to this all in one shot, using indirect indexing
with <code class="docutils literal notranslate"><span class="pre">.loc</span></code> or <code class="docutils literal notranslate"><span class="pre">iloc</span></code>.</p>
<p>For example, you have just seen that this generates an error, and why:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6234/1657792584.py:1: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df[&quot;col&quot;][row_indexer] = value

Use `df.loc[row_indexer, &quot;col&quot;] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  ratings.loc[&#39;A&#39;].loc[&#39;Clarity&#39;] = 299
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">SettingWithCopyError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">/tmp/ipykernel_6234/1657792584.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_has_valid_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> 
<span class="g g-Whitespace">    </span><span class="mi">910</span>         <span class="n">iloc</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;iloc&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">iloc</span>
<span class="ne">--&gt; </span><span class="mi">911</span>         <span class="n">iloc</span><span class="o">.</span><span class="n">_setitem_with_indexer</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1940</span>         <span class="k">if</span> <span class="n">take_split_path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1941</span>             <span class="c1"># We have to operate column-wise</span>
<span class="g g-Whitespace">   </span><span class="mi">1942</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_with_indexer_split_path</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1943</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1944</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_single_block</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/indexing.py</span> in <span class="ni">?</span><span class="nt">(self, indexer, value, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">2211</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ABCDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;iloc&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2212</span>             <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_align_frame</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span> 
<span class="g g-Whitespace">   </span><span class="mi">2214</span>         <span class="c1"># check for chained assignment</span>
<span class="ne">-&gt; </span><span class="mi">2215</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2216</span> 
<span class="g g-Whitespace">   </span><span class="mi">2217</span>         <span class="c1"># actually do the set</span>
<span class="g g-Whitespace">   </span><span class="mi">2218</span>         <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_mgr</span><span class="o">.</span><span class="n">setitem</span><span class="p">(</span><span class="n">indexer</span><span class="o">=</span><span class="n">indexer</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/series.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1489</span>             <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cacher</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1490</span>             <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ref</span><span class="o">.</span><span class="n">_is_mixed_type</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1491</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_check_setitem_copy</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s2">&quot;referent&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1492</span>             <span class="k">return</span> <span class="kc">True</span>
<span class="ne">-&gt; </span><span class="mi">1493</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_check_is_chained_assignment_possible</span><span class="p">()</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">4395</span>         <span class="n">single</span><span class="o">-</span><span class="n">dtype</span> <span class="n">meaning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">cacher</span> <span class="n">should</span> <span class="n">be</span> <span class="n">updated</span> <span class="n">following</span>
<span class="g g-Whitespace">   </span><span class="mi">4396</span>         <span class="n">setting</span><span class="o">.</span>
<span class="g g-Whitespace">   </span><span class="mi">4397</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4398</span><span class="s2">         if self._is_copy:</span>
<span class="ne">-&gt; </span><span class="mi">4399</span><span class="s2">             self._check_setitem_copy(t=&quot;referent&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">4400</span><span class="s2">         return False</span>

<span class="nn">/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self, t, force)</span>
<span class="g g-Whitespace">   </span><span class="mi">4469</span><span class="s2">                 &quot;indexing.html#returning-a-view-versus-a-copy&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4470</span><span class="s2">             )</span>
<span class="g g-Whitespace">   </span><span class="mi">4471</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4472</span><span class="s2">         if value == &quot;raise&quot;:</span>
<span class="ne">-&gt; </span><span class="mi">4473</span><span class="s2">             raise SettingWithCopyError(t)</span>
<span class="g g-Whitespace">   </span><span class="mi">4474</span><span class="s2">         if value == &quot;warn&quot;:</span>
<span class="g g-Whitespace">   </span><span class="mi">4475</span><span class="s2">             warnings.warn(t, SettingWithCopyWarning, stacklevel=find_stack_level())</span>

<span class="ne">SettingWithCopyError</span>: 
<span class="s2">A value is trying to be set on a copy of a slice from a DataFrame</span>

<span class="s2">See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</span>
</pre></div>
</div>
</div>
</div>
<p>You can avoid that error by doing all your left-hand-side indexing in one shot,
like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Clarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">299</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Discipline               English
Number of Professors       23343
Clarity                    299.0
Helpfulness             3.821866
Overall Quality         3.791364
Easiness                3.162754
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Notice there is no error.  This is because, in this second case, Pandas gets
all the instructions in one go.  It can see from this combined instruction that
we <em>meant</em> to set the ‘Clarity’ value for the row labeled ‘A’ in the <code class="docutils literal notranslate"><span class="pre">ratings</span></code>
DataFrame, and does just this.</p>
</section>
<section id="old-strategy-summary-keep-calm-follow-the-three-rules">
<h3>Old strategy summary: keep calm, follow the three rules<a class="headerlink" href="#old-strategy-summary-keep-calm-follow-the-three-rules" title="Link to this heading">#</a></h3>
<p>Do not worry if some of this is not immediately clear; it is not easy.</p>
<p>The trick is to remember the three rules:</p>
<ul class="simple">
<li><p>Copy right.</p></li>
<li><p>Make copy warnings into errors.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.loc</span></code> and <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> for your left-hand-side indexing.</p></li>
</ul>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="copy-write" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>In fact Pandas is even cleverer than that.
<code class="docutils literal notranslate"><span class="pre">ratings['Clarity']</span></code> <em>is</em> a view, to save unnecessary duplication of memory,
but when you do <code class="docutils literal notranslate"><span class="pre">clarity.loc['A']</span> <span class="pre">=</span> <span class="pre">99</span></code>, Pandas detects the <em>write</em> operation
on the view, and then, under the hood, does a copy, so the write operation
works on the copy, and not on the original.  Hence <em>copy on write</em>.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "lisds/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./wild-pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../useful-pandas/merge.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Merging</p>
      </div>
    </a>
    <a class="right-next"
       href="text_encoding.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Storing and loading text</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-have-pandas-version-1-5-or-later-you-can-skip-this-page">If you have Pandas version 1.5 or later, you can skip this page</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avoiding-trouble">Avoiding trouble</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-copies-and-views">Background: copies and views</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-strategy-pandas-1-5-automatic-copies-when-needed">New Strategy (Pandas &gt;= 1.5): automatic copies when needed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chained-assignment-and-copy-on-write">“Chained assignment” and copy-on-write</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-for-pandas-1-5-three-simple-rules">Old Strategy (for Pandas &lt; 1.5): three simple rules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-1-copy-right">Old strategy rule 1: copy right.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-digression-copies-views-confusing-warnings">A digression: copies, views, confusing, warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-2-make-errors-for-copy-view-warnings">Old strategy rule 2: make errors for copy/view warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-digression-copy-views-on-the-left">Another digression: copy, views, on the left</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-rule-3-loc-left">Old strategy rule 3: loc left</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#old-strategy-summary-keep-calm-follow-the-three-rules">Old strategy summary: keep calm, follow the three rules</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matthew Brett, Ani Adhikari, John Denero, David Wagner
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>